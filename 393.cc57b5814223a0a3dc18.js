(self.webpackChunkngx_al_libs=self.webpackChunkngx_al_libs||[]).push([[393],{1393:(e,t,i)=>{"use strict";i.r(t),i.d(t,{NgxAlGraphicalReportsDesignerModule:()=>S});var o=i(37716),r=i(38583),s=i(31077),a=i(9462),n=i(22238),l=i(29790),d=i(77310),c=i(11343),p=i(19261),h=i(3679);function m(e,t){if(1&e&&(o.TgZ(0,"span",17,18),o._UZ(2,"i",19),o._uU(3),o.qZA()),2&e){const e=t.$implicit;o.Q6J("cdkDragData",e),o.xp6(3),o.hij("",e.name," ")}}function g(e,t){if(1&e){const e=o.EpF();o.ynx(0),o.TgZ(1,"li",20),o._uU(2),o.TgZ(3,"span",21),o.NdJ("click",function(){const t=o.CHM(e).$implicit;return o.oxw().removeRole(t)}),o.qZA(),o.qZA(),o.BQk()}if(2&e){const e=t.$implicit;o.xp6(2),o.hij(" ",e.name," ")}}let u=(()=>{class e{constructor(e,t,i,o){this.roleApiSvc=e,this.data=t,this.dialogRef=i,this.translate=o,this.changedRoles=[],this.rParams=t.rparms,this.viewSvc=t.viewSvc}ngOnInit(){this.getRoles()}drop(e){this.addRole(e.item.data),console.log(e)}getRoles(){this.roleApiSvc.get("",(0,a.mag)(this.rParams)).subscribe(e=>{this.roles=e,this.viewSvc.formSchema.roleIds&&this.viewSvc.formSchema.roleIds.length>0?this.changedRoles=this.roles.filter(e=>this.viewSvc.formSchema.roleIds.includes(e.entityId)):this.viewSvc.formSchema.roleIds=[]})}addRole(e){this.viewSvc.formSchema.roleIds.findIndex(t=>t==e.entityId)<0&&(this.viewSvc.formSchema.roleIds.push(e.entityId),this.changedRoles.findIndex(t=>t.entityId==e.entityId)<0&&this.changedRoles.push(e))}removeRole(e){let t=this.viewSvc.formSchema.roleIds.findIndex(t=>t==e.entityId);if(t>=0){this.viewSvc.formSchema.roleIds.splice(t,1);var i=this.changedRoles.findIndex(t=>t.entityId==e.entityId);i>=0&&this.changedRoles.splice(i,1)}}close(){this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(a.VDR),o.Y36(n.WI),o.Y36(n.so),o.Y36(l.sK))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-roles-popup"]],decls:26,vars:8,consts:[[1,"wf-popup"],[1,"form-horizontal","form-section"],["cdkDropListGroup","",1,"row"],[1,"col-lg-4","col-md-12","col-sm-12","col-12","mb-2"],["id","rulesAccordion",1,"accordion"],[1,"card","workflowrules-card","mb-3"],["data-toggle","collapse","data-target","#rulesCollapse","aria-expanded","true",1,"card-header","cursor-pointer"],[1,"mb-0"],["id","rulesCollapse","data-parent","#rulesAccordion",1,"collapse","show"],[1,"card-body"],["id","ddlActivity","cdkDropList","",1,"text-dark"],["cdkDrag","","class","ui-draggable ui-draggable-handle",3,"cdkDragData",4,"ngFor","ngForOf"],[1,"col-lg-8","col-md-12","col-sm-12","col-12","dragOptions-section"],["cdkDropList","",1,"actionDrop","ui-droppable",2,"border","dashed",3,"cdkDropListDropped"],[1,"list-group","text-dark"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-secondary","px-md-3","createapp-btn",3,"click"],["cdkDrag","",1,"ui-draggable","ui-draggable-handle",3,"cdkDragData"],["btn",""],[1,"fas","fa-arrows-alt","mr-2"],[1,"list-group-item"],[1,"fas","fa-close","cursor-pointer","roleLabelClose",3,"click"]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"h5"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"div",1),o.TgZ(5,"div",2),o.TgZ(6,"div",3),o.TgZ(7,"div",4),o.TgZ(8,"div",5),o.TgZ(9,"div",6),o.TgZ(10,"a",7),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.qZA(),o.TgZ(13,"div",8),o.TgZ(14,"div",9),o.TgZ(15,"div",10),o.YNc(16,m,4,2,"span",11),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(17,"div",12),o.TgZ(18,"div",13),o.NdJ("cdkDropListDropped",function(e){return t.drop(e)}),o._uU(19," Drop The Desired Roles Here "),o.qZA(),o.TgZ(20,"ul",14),o.YNc(21,g,4,1,"ng-container",15),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(22,"div"),o.TgZ(23,"button",16),o.NdJ("click",function(){return t.close()}),o.TgZ(24,"span"),o._uU(25,"Close"),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(2),o.hij(" ",o.lcZ(3,4,"Roles")," "),o.xp6(9),o.Oqu(o.lcZ(12,6,"Roles")),o.xp6(5),o.Q6J("ngForOf",t.roles),o.xp6(5),o.Q6J("ngForOf",t.changedRoles))},directives:[d.Fd,d.Wj,r.sg,d.Zt],pipes:[l.X$],styles:[".actionDrop[_ngcontent-%COMP%], .dropOptions[_ngcontent-%COMP%]{line-height:90px;text-align:center;margin-bottom:15px;border:1px dashed #5a7fff;height:100px;color:#5a7fff}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer!important}#ddlActivity[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], #ddlCustomActivity[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .dragOptions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;cursor:move;padding:5px 10px;background-color:#e7eaf1;margin-bottom:5px;line-height:25px;font-size:13px;box-shadow:none;transition:box-shadow .3s ease-in-out;color:#50555f;border-radius:3px;width:100%;position:relative;z-index:1}"]}),e})();const v=[{path:"",component:(()=>{class e{constructor(e,t,i,o,r,s,n){this.viewSvc=e,this._location=t,this.dialog=i,this.propertiesSvc=o,this.roleApiSvc=r,this.route=s,this.storage=n,this.formSchema=void 0,this.layoutItem=void 0,a.aqO.subscribe(e=>this.rParams=e),this.viewSvc.formSchema$.subscribe(e=>{if(this.designer){this.designer.report.loadDocument(e.jsonSchema);var t=new c.Stimulsoft.Report.Dictionary.StiVariable("","User","User",typeof String),i=new c.Stimulsoft.Report.Dictionary.StiVariable("","recordEntityId","recordEntityId",typeof String),o=new c.Stimulsoft.Report.Dictionary.StiVariable("","IpAddress","IpAddress",typeof String),r=new c.Stimulsoft.Report.Dictionary.StiVariable("","url","url",typeof String),s=new c.Stimulsoft.Report.Dictionary.StiVariable("","graphReportId","graphReportId",typeof String);this.designer.report.dictionary.variables.add(t),this.designer.report.dictionary.variables.add(i),this.designer.report.dictionary.variables.add(o),this.designer.report.dictionary.variables.add(r),this.designer.report.dictionary.variables.add(s),this.designer.renderHtml("designer"),this.designer.viewer.jsObject.options.appearance.minParametersCountForMultiColumns=1,this.viewSvc.formSchema=this.formSchema}}),this.viewSvc.getLayout(),this.viewSvc.validationPopUp$.subscribe(e=>this.validateDetails(e))}ngOnInit(){console.log("Loading Designer view"),console.log("Set full screen mode for the designer"),this.options=new c.Stimulsoft.Designer.StiDesignerOptions,this.options.appearance.fullScreenMode=!1,this.options.toolbar.showFileMenu=!0,this.options.viewerOptions.appearance.parametersPanelColumnsCount=4,c.StiOptions.Export.Pdf.divideSegmentPages=!1,this.options.appearance.parametersPanelDateFormat="dd/MM/yyyy",this.options.appearance.showTooltipsHelp=!1,this.options.appearance.showDialogsHelp=!1,console.log("Create the dashboard designer with specified options"),this.designer=new c.Stimulsoft.Designer.StiDesigner(this.options,"StiDesigner",!1),c.StiOptions.WebServer.url=(0,a.CBd)()+"api/reportquery/DataAdapter",c.Stimulsoft.Base.StiLicense.key="6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHkgWK3zcs2OkVE3pbdmr5az7YhDM6Dwd5Aidm7rEniWrrV0ay8lSwXQeVuTewKTSdpLIq+39NzdAx3jIm6zeeNRg2WnSeefguayBttBXF3hXlPcRiBEEtm03YqoFpGdTIEgPfMKXunvsBo0a+116WQwj8MFOpaHmeyxX4gOdLucfPANpbeyBGVWX3JpafvJr6K2PwBuaBUGeJF5bXprJlBcebZD3fgXYBE4Y553R3gzjmo2NUY2R4C4ers1Tg6hwKbZZaBnj0Hmmtbi7gn/UfGp3KQlPQdV1p7lWA8qaTZk7W6xH6NFMYh7JwKtYiKDCyARGjAsEEfALg1uh/MKS8ZIf1pmDGsJlvk9wndqLq4ZWseMDUuhjK1ZmKVFNjBcLEi/zqbklxQK3GnHiq6+8xJ/Brr255Z7pFSEnmgTkN8rcat+znkZn0y/0m3yuDHSrNZhaNCDym4x2kCIG+HDzK45YDFCYginr9b880JtPBzxuyOM2F3MpHw5mY8/2YxQRh1F1YTWyePVZXB8/W6GURNhpr8/v/8fiXoka8/oPiPBUQ==",console.log("Edit dashboard template in the designer"),this.designer.report=c.Stimulsoft.Report.StiReport.createNewDashboard(),this.designer.onSaveReport=e=>{let t=e.report.saveToJsonString(),i=e.fileName;this.viewSvc.formSchema$.value.name=e.fileName,this.viewSvc.formSchema$.value.systemName=i,this.viewSvc.formSchema$.value.jsonSchema=t,this.saveForm()},console.log("Load dashboard from url"),console.log("Rendering the designer to selected element"),this.designer.renderHtml("designer"),console.log("Loading completed successfully!")}get form(){return this.propertiesSvc.form}get title(){return this.form.get("title")}saveForm(){if(""==this.viewSvc.formSchema$.value.name||""==this.viewSvc.formSchema$.value.systemName)return $("#formDetailsModal").modal({backdrop:"static",keyboard:!1}),!1;this.viewSvc.saveForm()}validateDetails(e){if(null!=e){var t=Object.entries(e),i=[],o="";$("#formvalidationerrors").length>0&&$("#formvalidationerrors").remove();for(var r=new Object,s=0;s<t.length;s++){var a=JSON.parse(t[s][1]);if(r[a.name]){var n=r[a.name];n.push(a),r[a.name]=n}else{var l=new Array;l.push(a),r[a.name]=l}}i=[];for(let e in r)if(o="",r.hasOwnProperty(e)&&void 0!==r[e]&&null!=r[e]){var d=e+" : ";i.push('<div class="ErrorMsgList">'),i.push("<h6>"+d+"</h6>");for(let t in r[e])r[e].hasOwnProperty(t)&&i.push(o="<ul><li><b>"+r[e][t].property+"</b> - <span>"+r[e][t].errorMessage+"</span></li></ul>");i.push("</div>")}o=i.join(""),$("#formvalidationerrors").length>0&&$("#formvalidationerrors").remove();var c='<div class="modal fade" data-backdrop="static" data-keyboard="false" id="formvalidationerrors" role="dialog"> <div class="modal-dialog modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header" style="background:#ff4c52"> <div class="d-flex align-items-center"><i class="fas fa-exclamation-triangle text-white text-lg mr-2"></i> <h5 class="modal-title text-white">Alert</h5> </div> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"> '+o+" </div></div></div></div>";$("body").append(c),$("#formvalidationerrors").modal("show")}}isSaveDisabled(){return this.layoutItem.children.length<1}isClearDisabled(){return this.layoutItem.children.length<1}clearCanvas(){return 1==confirm("Do you want to clear?")&&(this.viewSvc.clearSchema(),!0)}openFormDialog(){}showFormsPopup(e){this.formName=this.formSchema.name,$("#formDetailsModal").modal({backdrop:"static",keyboard:!1})}showRolesPopup(e){this.dialog.open(u,{data:{rparms:this.rParams,viewSvc:this.viewSvc}}).updateSize("80vw")}back(){this._location.back()}onWindowClose(e){this.storage.SetParamState(a.aqO.value)}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(a.WZo),o.Y36(r.Ye),o.Y36(n.uw),o.Y36(a.C8z,8),o.Y36(a.VDR),o.Y36(s.gz),o.Y36(a.eJM))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-view-designer"]],hostBindings:function(e,t){1&e&&o.NdJ("beforeunload",function(e){return t.onWindowClose(e)},!1,o.Jf7)},features:[o._Bn([a.WZo])],decls:1,vars:0,consts:[["id","designer"]],template:function(e,t){1&e&&o._UZ(0,"div",0)},styles:[""]}),e})(),canActivate:[a.N9q]}];let f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[s.Bz.forChild(v)],s.Bz]}),e})(),S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[a.s1G],imports:[[r.ez,f,p.UH,h.u5,h.UX,d._t,l.aw]]}),e})()}}]);